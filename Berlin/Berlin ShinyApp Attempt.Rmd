---
title: "Berlin ShinyApp Attempt"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(here)
library(naniar)
library(ggvenn)
library(VennDiagram)
library(shiny)
library(shinydashboard)
library(trekcolors)
library(ggplot2)
``` 

```{r}
getwd()
```


```{r}
microbiome <- read_csv(here("Berlin/a_ref_microbiome.csv"))
asd_group <- read_csv(here("Berlin/a_ref_asd_group.csv"))
td_group <- read_csv(here("Berlin/a_ref_td_group.csv"))
microbiome_diversity <- read_csv(here("Berlin/a_ref_microbiome_diversity.csv"))
unique_genera <- read_csv(here("Berlin/unique_genera.csv"))
```
Graphs Comparing TD and ASD Groups (Unfinished)
```{r, eval=F, echo=T}
ui <- fluidPage(    
  
  titlePanel("TD and ASD Species/Genus Abundance"), 
  sidebarLayout(      
  sidebarPanel(
  selectInput("genus", "species", " Select Group of Interest:", choices=unique(microbiome_diversity$group)),
      hr(),
      helpText("Reference: Zhou Dan et al. (2020) Altered gut microbial profile is associated with abnormal metabolism activity of Autism Spectrum Disorder, Gut Microbes, 11:5, 1246-1267, DOI: 10.1080/19490976.2020.1747329")
    ),
    mainPanel(
      plotOutput("Plot")  
    )
    )
    )
server <- function(input, output, session) {
  session$onSessionEnded(stopApp)
  output$Plot <- renderPlot({
  ggplot(microbiome_diversity, aes_string(x = input$x, y = input$y, fill= "group")) + geom_col(position = "dodge") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + theme(plot.title = element_text(size = rel(1.5), hjust = 0.5))+ scale_fill_trek("romulan")
  })
  session$onSessionEnded(stopApp)
  }

shinyApp(ui, server)
```
Venn Diagram Attempt
```{r, eval=F, echo=T}
shinyServer(function(input, output) {
  
  output$vennDiagram <- renderPlot({
    
    # Only plot the Venn diagram if the input values are legit (the input values
    # are all available and the intersection area isn't greater than either individual set). 
    if(as.numeric(req(input$adobeGoogle)) <= as.numeric(req(input$adobe)) &&
       as.numeric(req(input$adobeGoogle)) <= as.numeric(req(input$google))){

      draw.pairwise.venn(area1 = as.numeric(input$google),
                         area2 = as.numeric(input$adobe),
                         cross.area = as.numeric(input$adobeGoogle),
                         category = c("Google Analytics","Adobe Analytics"),
                         fill = c("#F29B05","#A1D490"),
                         ext.text = TRUE,
                         ext.percent = c(0.1,0.1,0.1),
                         ext.length = 0.6,
                         label.col = rep("gray10",3),
                         lwd = 0,
                         cex = 2,
                         fontface = rep("bold",3),
                         fontfamily = rep("sans",3), 
                         cat.cex = 1.5,
                         cat.fontface = rep("plain",2),
                         cat.fontfamily = rep("sans",2),
                         cat.pos = c(0, 0),
                         print.mode = c("percent","raw")
                         )
    }
  })
})

```

Graphs comparing Genus, Species, and Unique Counts
```{r, eval=F, echo=T}
ui <- dashboardPage(
  dashboardHeader(title = "Abundance"),
  dashboardSidebar(),
  dashboardBody(
  selectInput("x", "Select X Variable", choices = c("group"), selected = "group"),
  selectInput("y", "Select Y Variable", choices = c("n_genus", "n_species", "unique_counts"), selected = "n_genus"),
  plotOutput("plot", width = "500px", height = "400px"))
)

server <- function(input, output, session) { 
  output$plot <- renderPlot({
  ggplot(microbiome_diversity, aes_string(x = input$x, y = input$y, fill= "group")) + geom_col(position = "dodge") + theme(axis.text.x = element_text()) + theme(plot.title = element_text(size = rel(1.5)))+ scale_fill_brewer(palette = "Set1")
  })
  session$onSessionEnded(stopApp)
  }
shinyApp(ui, server)
```
